<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Pendaftaran Peserta via PT POS</title>
    <!-- Memuat Chart.js untuk grafik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS untuk font dan sedikit penyesuaian yang tidak ada di Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e6f7e6; /* Warna latar belakang hijau sangat muda */
        }
        /* Mengatur agar canvas responsif */
        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body class="bg-green-50 p-4 sm:p-6 md:p-8">
    <div class="container mx-auto bg-white rounded-xl shadow-lg p-6 sm:p-8 md:p-10 relative">
        <!-- Logo BPTAPERA (Kiri Atas) -->
        <!-- Menggunakan placeholder image. Ganti dengan URL logo asli Anda. -->
        <img src="https://placehold.co/120x60/166534/ffffff?text=BPTAPERA+Logo" alt="Logo BPTAPERA" class="absolute top-4 left-4 h-12 w-auto rounded-md shadow-sm">

        <!-- Logo PT Pos (Kanan Atas) -->
        <!-- Menggunakan placeholder image. Ganti dengan URL logo asli Anda. -->
        <img src="https://placehold.co/120x60/166534/ffffff?text=PT+Pos+Logo" alt="Logo PT Pos" class="absolute top-4 right-4 h-12 w-auto rounded-md shadow-sm">

        <h1 class="text-3xl sm:text-4xl font-extrabold text-green-800 mb-6 text-center mt-16">
            Dashboard Pendaftaran Peserta via PT POS ðŸ“®
        </h1>
        <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">
            Selamat datang di dashboard pendaftaran peserta melalui kantor pos. Anda dapat memantau data pendaftaran dan melihat statistik top kantor pos.
        </p>

        <!-- Bagian Chart Top 5 -->
        <div class="chart-section mt-6 mb-8 bg-green-50 p-6 rounded-lg shadow-md">
            <h2 class="text-2xl sm:text-3xl font-bold text-green-700 mb-6 text-center">
                Top 5 Kantor Pos dengan Peserta Terbanyak ðŸ“ˆ
            </h2>
            <canvas id="topKantorChart" class="bg-white p-4 rounded-lg shadow-inner"></canvas>
        </div>

        <!-- Bagian Filter -->
        <div class="filter-section bg-green-50 p-4 rounded-lg mb-8 flex flex-col sm:flex-row items-center justify-center gap-4 shadow-sm">
            <label for="kodeKantorFilter" class="font-semibold text-green-700 text-lg">Filter Kode/Nama Kantor Pos:</label>
            <input type="text" id="kodeKantorFilter" placeholder="Contoh: 10001 atau Jakarta"
                   class="p-3 border border-green-300 rounded-md w-full sm:w-auto flex-grow focus:ring-2 focus:ring-green-400 focus:border-transparent transition duration-200 ease-in-out">

            <label for="monthFilter" class="font-semibold text-green-700 text-lg sm:ml-4">Filter Bulan:</label>
            <select id="monthFilter" class="p-3 border border-green-300 rounded-md w-full sm:w-auto focus:ring-2 focus:ring-green-400 focus:border-transparent transition duration-200 ease-in-out">
                <option value="all">Semua Bulan</option>
                <!-- Opsi bulan akan dimuat oleh JavaScript -->
            </select>
        </div>

        <!-- Bagian Tabel Data -->
        <h2 class="text-2xl sm:text-3xl font-bold text-green-700 mb-5 text-center">
            Tabel Data Pendaftaran Peserta
        </h2>
        <div class="overflow-x-auto rounded-lg shadow-md">
            <table id="dataPesertaTable" class="min-w-full bg-white">
                <thead class="bg-green-700 text-white">
                    <tr>
                        <th class="py-3 px-4 text-left text-sm font-medium uppercase tracking-wider rounded-tl-lg">Kode Kantor Pos</th>
                        <th class="py-3 px-4 text-left text-sm font-medium uppercase tracking-wider">Nama Kantor Pos</th>
                        <th class="py-3 px-4 text-left text-sm font-medium uppercase tracking-wider rounded-tr-lg" id="jumlahPesertaHeader">Jumlah Peserta Total</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    <!-- Data akan dimuat di sini oleh JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Bagian Chart Pertumbuhan Peserta Tiap Bulan (Baru) -->
        <div class="chart-section mt-12 bg-green-50 p-6 rounded-lg shadow-md">
            <h2 class="text-2xl sm:text-3xl font-bold text-green-700 mb-6 text-center">
                Grafik Pertumbuhan Peserta Keseluruhan Tiap Bulan ðŸ“ˆ
            </h2>
            <canvas id="monthlyGrowthChart" class="bg-white p-4 rounded-lg shadow-inner"></canvas>
        </div>
    </div>

    <script>
        // Data Contoh (akan diganti dengan data dari server/API di aplikasi nyata)
        // Setiap kantor pos sekarang memiliki array 'monthly_data'
        let allData = [
            {
                kode: '10001',
                nama: 'Kantor Pos Jakarta Pusat',
                monthly_data: [
                    { month: 'Januari', jumlah: 50 },
                    { month: 'Februari', jumlah: 40 },
                    { month: 'Maret', jumlah: 60 },
                    { month: 'April', jumlah: 55 },
                    { month: 'Mei', jumlah: 70 },
                    { month: 'Juni', jumlah: 75 },
                    { month: 'Juli', jumlah: 80 }
                ]
            },
            {
                kode: '10002',
                nama: 'Kantor Pos Surabaya',
                monthly_data: [
                    { month: 'Januari', jumlah: 80 },
                    { month: 'Februari', jumlah: 70 },
                    { month: 'Maret', jumlah: 70 },
                    { month: 'April', jumlah: 85 },
                    { month: 'Mei', jumlah: 90 },
                    { month: 'Juni', jumlah: 95 },
                    { month: 'Juli', jumlah: 100 }
                ]
            },
            {
                kode: '10003',
                nama: 'Kantor Pos Bandung',
                monthly_data: [
                    { month: 'Januari', jumlah: 60 },
                    { month: 'Februari', jumlah: 50 },
                    { month: 'Maret', jumlah: 70 },
                    { month: 'April', jumlah: 65 },
                    { month: 'Mei', jumlah: 80 },
                    { month: 'Juni', jumlah: 82 },
                    { month: 'Juli', jumlah: 85 }
                ]
            },
            {
                kode: '10004',
                nama: 'Kantor Pos Medan',
                monthly_data: [
                    { month: 'Januari', jumlah: 30 },
                    { month: 'Februari', jumlah: 25 },
                    { month: 'Maret', jumlah: 35 },
                    { month: 'April', jumlah: 40 },
                    { month: 'Mei', jumlah: 45 },
                    { month: 'Juni', jumlah: 48 },
                    { month: 'Juli', jumlah: 50 }
                ]
            },
            {
                kode: '10005',
                nama: 'Kantor Pos Makassar',
                monthly_data: [
                    { month: 'Januari', jumlah: 40 },
                    { month: 'Februari', jumlah: 35 },
                    { month: 'Maret', jumlah: 45 },
                    { month: 'April', jumlah: 50 },
                    { month: 'Mei', jumlah: 55 },
                    { month: 'Juni', jumlah: 58 },
                    { month: 'Juli', jumlah: 60 }
                ]
            },
            {
                kode: '10006',
                nama: 'Kantor Pos Semarang',
                monthly_data: [
                    { month: 'Januari', jumlah: 25 },
                    { month: 'Februari', jumlah: 20 },
                    { month: 'Maret', jumlah: 30 },
                    { month: 'April', jumlah: 28 },
                    { month: 'Mei', jumlah: 32 },
                    { month: 'Juni', jumlah: 35 },
                    { month: 'Juli', jumlah: 38 }
                ]
            },
            {
                kode: '10007',
                nama: 'Kantor Pos Yogyakarta',
                monthly_data: [
                    { month: 'Januari', jumlah: 45 },
                    { month: 'Februari', jumlah: 40 },
                    { month: 'Maret', jumlah: 50 },
                    { month: 'April', jumlah: 48 },
                    { month: 'Mei', jumlah: 52 },
                    { month: 'Juni', jumlah: 55 },
                    { month: 'Juli', jumlah: 58 }
                ]
            },
            {
                kode: '10008',
                nama: 'Kantor Pos Denpasar',
                monthly_data: [
                    { month: 'Januari', jumlah: 90 },
                    { month: 'Februari', jumlah: 85 },
                    { month: 'Maret', jumlah: 75 },
                    { month: 'April', jumlah: 95 },
                    { month: 'Mei', jumlah: 100 },
                    { month: 'Juni', jumlah: 105 },
                    { month: 'Juli', jumlah: 110 }
                ]
            },
            {
                kode: '10009',
                nama: 'Kantor Pos Palembang',
                monthly_data: [
                    { month: 'Januari', jumlah: 20 },
                    { month: 'Februari', jumlah: 15 },
                    { month: 'Maret', jumlah: 25 },
                    { month: 'April', jumlah: 22 },
                    { month: 'Mei', jumlah: 28 },
                    { month: 'Juni', jumlah: 30 },
                    { month: 'Juli', jumlah: 33 }
                ]
            },
            {
                kode: '10010',
                nama: 'Kantor Pos Balikpapan',
                monthly_data: [
                    { month: 'Januari', jumlah: 70 },
                    { month: 'Februari', jumlah: 60 },
                    { month: 'Maret', jumlah: 60 },
                    { month: 'April', jumlah: 75 },
                    { month: 'Mei', jumlah: 80 },
                    { month: 'Juni', jumlah: 85 },
                    { month: 'Juli', jumlah: 90 }
                ]
            },
            {
                kode: '10011',
                nama: 'Kantor Pos Malang',
                monthly_data: [
                    { month: 'Januari', jumlah: 55 },
                    { month: 'Februari', jumlah: 50 },
                    { month: 'Maret', jumlah: 60 },
                    { month: 'April', jumlah: 58 },
                    { month: 'Mei', jumlah: 62 },
                    { month: 'Juni', jumlah: 65 },
                    { month: 'Juli', jumlah: 68 }
                ]
            },
            {
                kode: '10012',
                nama: 'Kantor Pos Solo',
                monthly_data: [
                    { month: 'Januari', jumlah: 30 },
                    { month: 'Februari', jumlah: 28 },
                    { month: 'Maret', jumlah: 27 },
                    { month: 'April', jumlah: 35 },
                    { month: 'Mei', jumlah: 38 },
                    { month: 'Juni', jumlah: 40 },
                    { month: 'Juli', jumlah: 42 }
                ]
            },
            {
                kode: '10013',
                nama: 'Kantor Pos Padang',
                monthly_data: [
                    { month: 'Januari', jumlah: 35 },
                    { month: 'Februari', jumlah: 30 },
                    { month: 'Maret', jumlah: 35 },
                    { month: 'April', jumlah: 40 },
                    { month: 'Mei', jumlah: 42 },
                    { month: 'Juni', jumlah: 45 },
                    { month: 'Juli', jumlah: 48 }
                ]
            },
            {
                kode: '10014',
                nama: 'Kantor Pos Pontianak',
                monthly_data: [
                    { month: 'Januari', jumlah: 50 },
                    { month: 'Februari', jumlah: 45 },
                    { month: 'Maret', jumlah: 45 },
                    { month: 'April', jumlah: 50 },
                    { month: 'Mei', jumlah: 55 },
                    { month: 'Juni', jumlah: 58 },
                    { month: 'Juli', jumlah: 60 }
                ]
            },
            {
                kode: '10015',
                nama: 'Kantor Pos Samarinda',
                monthly_data: [
                    { month: 'Januari', jumlah: 25 },
                    { month: 'Februari', jumlah: 22 },
                    { month: 'Maret', jumlah: 28 },
                    { month: 'April', jumlah: 30 },
                    { month: 'Mei', jumlah: 33 },
                    { month: 'Juni', jumlah: 35 },
                    { month: 'Juli', jumlah: 38 }
                ]
            }
        ];

        let chartInstanceTop5; // Variabel untuk menyimpan instance chart Top 5
        let chartInstanceMonthlyGrowth; // Variabel untuk menyimpan instance chart Pertumbuhan Bulanan

        // Warna-warna untuk garis grafik pertumbuhan bulanan (hanya satu warna karena ini grafik total)
        const overallGrowthLineColor = 'rgba(22, 101, 52, 1)'; // green-800

        /**
         * Menghitung total jumlah peserta dari data bulanan.
         * @param {Array<Object>} monthlyData - Array objek data bulanan ({ month: string, jumlah: number }).
         * @returns {number} Total jumlah peserta.
         */
        function calculateTotalParticipants(monthlyData) {
            return monthlyData.reduce((sum, m) => sum + m.jumlah, 0);
        }

        /**
         * Mengambil jumlah peserta untuk bulan tertentu.
         * @param {Array<Object>} monthlyData - Array objek data bulanan.
         * @param {string} month - Nama bulan yang dicari.
         * @returns {number} Jumlah peserta untuk bulan tersebut, atau 0 jika tidak ditemukan.
         */
        function getMonthlyParticipants(monthlyData, month) {
            const data = monthlyData.find(m => m.month === month);
            return data ? data.jumlah : 0;
        }

        /**
         * Mempersiapkan data untuk tabel dan chart Top 5 berdasarkan filter.
         * @param {string} kodeNamaFilter - Nilai filter kode/nama kantor pos.
         * @param {string} selectedMonth - Bulan yang dipilih ('all' atau nama bulan).
         * @returns {Array<Object>} Data yang sudah difilter dan dihitung.
         */
        function getFilteredAndCalculatedDataForTableAndTop5(kodeNamaFilter, selectedMonth) {
            const filteredByKodeNama = allData.filter(item =>
                item.kode.toLowerCase().includes(kodeNamaFilter.toLowerCase()) ||
                item.nama.toLowerCase().includes(kodeNamaFilter.toLowerCase())
            );

            return filteredByKodeNama.map(item => {
                let jumlahPeserta;
                if (selectedMonth === 'all') {
                    jumlahPeserta = calculateTotalParticipants(item.monthly_data);
                } else {
                    jumlahPeserta = getMonthlyParticipants(item.monthly_data, selectedMonth);
                }
                return {
                    kode: item.kode,
                    nama: item.nama,
                    jumlah: jumlahPeserta // Ini akan menjadi total atau bulanan
                };
            });
        }

        /**
         * Mempersiapkan data untuk grafik pertumbuhan bulanan keseluruhan.
         * Ini akan menjumlahkan peserta dari semua kantor pos yang terfilter per bulan.
         * @param {string} kodeNamaFilter - Nilai filter kode/nama kantor pos.
         * @param {Array<string>} allMonths - Semua bulan unik yang tersedia, diurutkan.
         * @returns {Array<number>} Array jumlah peserta total per bulan.
         */
        function getOverallMonthlyGrowthData(kodeNamaFilter, allMonths) {
            const filteredByKodeNama = allData.filter(item =>
                item.kode.toLowerCase().includes(kodeNamaFilter.toLowerCase()) ||
                item.nama.toLowerCase().includes(kodeNamaFilter.toLowerCase())
            );

            const monthlyTotals = {};
            allMonths.forEach(month => {
                monthlyTotals[month] = 0; // Inisialisasi total untuk setiap bulan
            });

            filteredByKodeNama.forEach(office => {
                office.monthly_data.forEach(monthData => {
                    if (monthlyTotals.hasOwnProperty(monthData.month)) {
                        monthlyTotals[monthData.month] += monthData.jumlah;
                    }
                });
            });

            // Konversi objek total bulanan menjadi array data sesuai urutan bulan
            return allMonths.map(month => monthlyTotals[month]);
        }


        /**
         * Merender data ke dalam tabel HTML.
         * @param {Array<Object>} dataToDisplay - Array objek data yang akan ditampilkan.
         * @param {string} selectedMonth - Bulan yang dipilih untuk header tabel.
         */
        function renderTable(dataToDisplay, selectedMonth) {
            const tableBody = document.querySelector('#dataPesertaTable tbody');
            const jumlahPesertaHeader = document.getElementById('jumlahPesertaHeader');

            // Perbarui header kolom jumlah peserta
            jumlahPesertaHeader.textContent = selectedMonth === 'all' ? 'Jumlah Peserta Total' : `Jumlah Peserta (${selectedMonth})`;

            tableBody.innerHTML = ''; // Mengosongkan tabel sebelum mengisi ulang

            if (dataToDisplay.length === 0) {
                // Tampilkan pesan jika tidak ada data
                const row = tableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 3; // Gabungkan 3 kolom
                cell.textContent = 'Tidak ada data yang ditemukan.';
                cell.className = 'text-center py-4 text-gray-500';
                return;
            }

            dataToDisplay.forEach(item => {
                const row = tableBody.insertRow();
                row.className = 'hover:bg-green-50 transition duration-150 ease-in-out'; // Efek hover
                row.insertCell().textContent = item.kode;
                row.insertCell().textContent = item.nama;
                row.insertCell().textContent = item.jumlah; // Tampilkan jumlah yang sudah dihitung (total/bulanan)
                // Menambahkan kelas Tailwind ke sel
                Array.from(row.cells).forEach(cell => {
                    cell.className = 'py-3 px-4 text-sm text-gray-700 whitespace-nowrap';
                });
            });
        }

        /**
         * Memperbarui atau membuat grafik top 5 kantor pos.
         * @param {Array<Object>} data - Array objek data yang sudah difilter dan dihitung.
         * @param {string} selectedMonth - Bulan yang dipilih untuk judul chart.
         */
        function updateTop5Chart(data, selectedMonth) {
            // Urutkan data berdasarkan jumlah peserta secara menurun
            const sortedData = [...data].sort((a, b) => b.jumlah - a.jumlah);
            // Ambil top 5 kantor pos
            const top5 = sortedData.slice(0, 5);

            const labels = top5.map(item => item.nama);
            const dataValues = top5.map(item => item.jumlah);

            const ctx = document.getElementById('topKantorChart').getContext('2d');

            // Hancurkan instance chart sebelumnya jika ada untuk menghindari duplikasi
            if (chartInstanceTop5) {
                chartInstanceTop5.destroy();
            }

            const chartTitle = selectedMonth === 'all' ? 'Top 5 Kantor Pos Pendaftar Terbanyak (Total)' : `Top 5 Kantor Pos Pendaftar Terbanyak (${selectedMonth})`;

            chartInstanceTop5 = new Chart(ctx, {
                type: 'bar', // Tipe grafik batang
                data: {
                    labels: labels, // Label untuk sumbu X (nama kantor pos)
                    datasets: [{
                        label: 'Jumlah Peserta',
                        data: dataValues, // Data untuk sumbu Y (jumlah peserta)
                        backgroundColor: [
                            'rgba(190, 242, 100, 0.8)', // Hijau muda (lime-300)
                            'rgba(147, 197, 253, 0.8)', // Biru muda (blue-300)
                            'rgba(251, 146, 60, 0.8)',  // Orange (orange-500)
                            'rgba(253, 224, 71, 0.8)',  // Kuning (yellow-300)
                            'rgba(244, 114, 182, 0.8)'  // Pink (pink-400)
                        ],
                        borderColor: [
                            'rgba(190, 242, 100, 1)',
                            'rgba(147, 197, 253, 1)',
                            'rgba(251, 146, 60, 1)',
                            'rgba(253, 224, 71, 1)',
                            'rgba(244, 114, 182, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true, // Mempertahankan rasio aspek canvas
                    plugins: {
                        legend: {
                            display: false // Sembunyikan legenda karena hanya ada satu dataset
                        },
                        title: {
                            display: true,
                            text: chartTitle, // Judul chart dinamis
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#166534' // green-800
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' peserta';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jumlah Peserta',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#4b5563' // Tailwind gray-700
                            },
                            ticks: {
                                precision: 0 // Pastikan tick y-axis adalah bilangan bulat
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Nama Kantor Pos',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#4b5563' // Tailwind gray-700
                            }
                        }
                    }
                }
            });
        }

        /**
         * Memperbarui atau membuat grafik pertumbuhan peserta keseluruhan tiap bulan.
         * @param {Array<number>} overallMonthlyData - Array jumlah peserta total per bulan.
         * @param {Array<string>} allMonths - Semua bulan unik yang tersedia, diurutkan.
         */
        function updateMonthlyGrowthChart(overallMonthlyData, allMonths) {
            const ctx = document.getElementById('monthlyGrowthChart').getContext('2d');

            if (chartInstanceMonthlyGrowth) {
                chartInstanceMonthlyGrowth.destroy();
            }

            chartInstanceMonthlyGrowth = new Chart(ctx, {
                type: 'line', // Tipe grafik garis
                data: {
                    labels: allMonths, // Label sumbu X adalah bulan-bulan
                    datasets: [{
                        label: 'Total Peserta', // Label untuk garis tunggal
                        data: overallMonthlyData,
                        borderColor: overallGrowthLineColor, // Warna garis tunggal
                        backgroundColor: overallGrowthLineColor.replace('1)', '0.2)'), // Warna latar belakang lebih transparan
                        fill: false, // Tidak mengisi area di bawah garis
                        tension: 0.1 // Sedikit kurva pada garis
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true, // Tampilkan legenda untuk label "Total Peserta"
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 12
                                },
                                color: '#333'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Grafik Pertumbuhan Peserta Keseluruhan Tiap Bulan',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#166534' // green-800
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' peserta';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jumlah Peserta',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#4b5563'
                            },
                            ticks: {
                                precision: 0
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Bulan',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#4b5563'
                            }
                        }
                    }
                }
            });
        }


        /**
         * Memperbarui tampilan dashboard (tabel dan kedua chart) berdasarkan filter.
         */
        function updateDashboard() {
            const kodeNamaFilter = document.getElementById('kodeKantorFilter').value;
            const selectedMonth = document.getElementById('monthFilter').value;

            // Data untuk tabel dan chart Top 5 (terpengaruh filter bulan)
            const processedDataForTableAndTop5 = getFilteredAndCalculatedDataForTableAndTop5(kodeNamaFilter, selectedMonth);
            renderTable(processedDataForTableAndTop5, selectedMonth);
            updateTop5Chart(processedDataForTableAndTop5, selectedMonth);

            // Ambil semua bulan unik yang ada di data, diurutkan secara kronologis
            const allMonths = Array.from(new Set(allData.flatMap(item => item.monthly_data.map(m => m.month)))).sort((a, b) => {
                const monthOrder = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                return monthOrder.indexOf(a) - monthOrder.indexOf(b);
            });

            // Data untuk chart pertumbuhan bulanan keseluruhan (hanya terpengaruh filter kode/nama)
            const overallMonthlyData = getOverallMonthlyGrowthData(kodeNamaFilter, allMonths);
            updateMonthlyGrowthChart(overallMonthlyData, allMonths);
        }

        /**
         * Mengisi dropdown filter bulan secara dinamis.
         */
        function populateMonthFilter() {
            const monthFilter = document.getElementById('monthFilter');
            const uniqueMonths = new Set();
            allData.forEach(item => {
                item.monthly_data.forEach(monthData => {
                    uniqueMonths.add(monthData.month);
                });
            });

            // Urutkan bulan secara kronologis
            const sortedMonths = Array.from(uniqueMonths).sort((a, b) => {
                const monthOrder = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                return monthOrder.indexOf(a) - monthOrder.indexOf(b);
            });

            sortedMonths.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthFilter.appendChild(option);
            });
        }

        // Event listener untuk input filter kode/nama kantor pos
        document.getElementById('kodeKantorFilter').addEventListener('keyup', updateDashboard);

        // Event listener untuk dropdown filter bulan
        document.getElementById('monthFilter').addEventListener('change', updateDashboard);

        // Inisialisasi dashboard saat seluruh konten DOM telah dimuat
        document.addEventListener('DOMContentLoaded', () => {
            populateMonthFilter(); // Isi dropdown bulan
            updateDashboard(); // Perbarui dashboard dengan filter awal
        });
    </script>
</body>
</html>
